<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<body>

<div class="p-6 max-w-4xl mx-auto">

    <h1 class="text-2xl font-bold text-purple-700 mb-6" th:text="${titulo}">Formulario Usuario</h1>

    <!-- Mensaje de error -->
    <div th:if="${error}" class="mb-4 p-3 bg-red-800 text-red-200 rounded">
        <span th:text="${error}"></span>
    </div>

    <form th:action="${usuario.id == null} ? 
                     @{/admin/usuarios/guardar} : 
                     @{/admin/usuarios/actualizar/{id}(id=${usuario.id})}"
          th:object="${usuario}"
          method="post"
          class="bg-gray-800 p-6 rounded-lg shadow-lg space-y-4">

        <!-- Campos ocultos si es edición -->
        <input type="hidden" th:field="*{id}" th:if="${usuario.id != null}">

        <!-- Grid de 2 columnas -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- Nombre -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Nombre *</label>
                <input type="text" th:field="*{nombre}" 
                       required
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Apellido -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Apellido *</label>
                <input type="text" th:field="*{apellido}" 
                       required
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- DNI -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">DNI *</label>
                <input type="text" th:field="*{dni}" 
                       required
                       maxlength="15"
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Usuario Login -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Usuario Login *</label>
                <input type="text" th:field="*{usuarioLogin}" 
                       required
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Contraseña -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Contraseña *</label>
                <input type="password" th:field="*{clave}" 
                       required
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Correo -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Correo</label>
                <input type="email" th:field="*{correo}" 
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Teléfono -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Teléfono</label>
                <input type="tel" th:field="*{telefono}" 
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Dirección -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Dirección</label>
                <input type="text" th:field="*{direccion}" 
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
            </div>

            <!-- Rol (SELECT) -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Rol *</label>
                <select th:field="*{rol.id}" 
                        required
                        class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
                    <option value="">-- Seleccione un rol --</option>
                    <option th:each="rol : ${roles}"
                            th:value="${rol.id}"
                            th:text="${rol.nombre}"
                            th:selected="${usuario?.rol?.id == rol.id}">
                    </option>
                </select>
            </div>

            <!-- Estado -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Estado</label>
                <select th:field="*{estado}" 
                        class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
                    <option th:each="estado : ${T(com.biblionet.model.UsuarioCrud$Estado).values()}"
                            th:value="${estado.name()}"
                            th:text="${#strings.capitalize(estado.name())}">
                    </option>
                </select>
            </div>

            <!-- Origen -->
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Origen</label>
                <select th:field="*{origen}" 
                        class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
                    <option th:each="origen : ${T(com.biblionet.model.UsuarioCrud$Origen).values()}"
                            th:value="${origen.name()}"
                            th:text="${#strings.capitalize(origen.name())}">
                    </option>
                </select>
            </div>

        </div> <!-- Fin del grid -->

        <!-- Botones -->
        <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-gray-700">
            <a th:href="@{/admin/usuarios}"
               class="px-4 py-2 border border-purple-500 text-purple-400 rounded-lg hover:bg-purple-500 hover:text-white transition">
                Cancelar
            </a>
            <button type="submit"
                    class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold">
                <span th:text="${usuario.id == null} ? 'Guardar' : 'Actualizar'">Guardar</span>
            </button>
        </div>

    </form>

</div>

</body>
</html>